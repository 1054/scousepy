<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Tutorial &#8212; scousepy 0.0.dev284 documentation</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="License" href="license.html" />
    <link rel="prev" title="A brief introduction to scousepy" href="description.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          scousepy</a>
        <span class="navbar-text navbar-version pull-left"><b>0.0.dev284</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installing <code class="docutils literal notranslate"><span class="pre">scousepy</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="description.html">A brief introduction to scousepy</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Tutorial</a><ul>
<li><a class="reference internal" href="#data">Data</a></li>
<li><a class="reference internal" href="#getting-started">Getting Started</a></li>
<li><a class="reference internal" href="#stage-1">Stage 1</a></li>
<li><a class="reference internal" href="#stage-2">Stage 2</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="description.html" title="Previous Chapter: A brief introduction to scousepy"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; A brief intro...</span>
    </a>
  </li>
  <li>
    <a href="license.html" title="Next Chapter: License"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">License &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/tutorial.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Tutorial</a><ul>
<li><a class="reference internal" href="#data">Data</a></li>
<li><a class="reference internal" href="#getting-started">Getting Started</a></li>
<li><a class="reference internal" href="#stage-1">Stage 1</a></li>
<li><a class="reference internal" href="#stage-2">Stage 2</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="tutorial">
<span id="id1"></span><h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>The aim of this tutorial is to give a basic introduction to the main workflow of
<code class="docutils literal notranslate"><span class="pre">scousepy</span></code>. Each stage will be described below along with some of the
important customisable keywords. All data for the tutorial can be found <a class="reference external" href="https://github.com/jdhenshaw/scousepy_tutorials">here</a>, along with some example
scripts.</p>
<div class="section" id="data">
<h2>Data<a class="headerlink" href="#data" title="Permalink to this headline">¶</a></h2>
<p>This tutorial utilises observations of N2H+ (1-0) towards the Infrared Dark
Cloud G035.39-00.33. This data set was first published in <a class="reference external" href="http://adsabs.harvard.edu/abs/2013MNRAS.428.3425H">Henshaw et al. 2013.</a>.
These observations were carried out with the IRAM 30m Telescope. IRAM is
supported by INSU/CNRS (France), MPG (Germany) and IGN (Spain). The data file
is in fits format and is named</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">n2h</span><span class="o">+</span><span class="mi">10</span><span class="n">_37</span><span class="o">.</span><span class="n">fits</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">scousepy</span></code> requires several key parameters that are worth setting as global
parameters. These can be set in the following way</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span>  <span class="s1">&#39;n2h+10_37&#39;</span>
<span class="n">datadirectory</span> <span class="o">=</span>  <span class="s1">&#39;./&#39;</span>
<span class="n">wsaa</span> <span class="o">=</span>  <span class="p">[</span><span class="mf">8.0</span><span class="p">]</span>

<span class="n">outputdir</span> <span class="o">=</span> <span class="s1">&#39;./myoutputdirectory/&#39;</span> <span class="c1"># optional</span>
<span class="n">ppv_vol</span> <span class="o">=</span> <span class="p">[</span><span class="mf">32.0</span><span class="p">,</span><span class="mf">42.0</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span> <span class="c1"># optional</span>
<span class="n">mask_below</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="c1"># optional</span>
</pre></div>
</div>
<p>Here <code class="docutils literal notranslate"><span class="pre">filename</span></code> is provided without the <code class="docutils literal notranslate"><span class="pre">.fits</span></code> extension. <code class="docutils literal notranslate"><span class="pre">datadirectory</span></code>
points to the location of the data. By default <code class="docutils literal notranslate"><span class="pre">scousepy</span></code> will create a new
directory in the same location as the input file. However, this can be changed
with the optional keyword <code class="docutils literal notranslate"><span class="pre">outputdir</span></code>. <code class="docutils literal notranslate"><span class="pre">wsaa</span></code> is used during stage 1. It
defines the maximum width of the region used to generate spatially averaged
spectra (see below).</p>
<p>The optional keywords listed above include <code class="docutils literal notranslate"><span class="pre">ppv_vol</span></code>, which allows the user to
control the region of the datacube over which to perform the fitting, and
<code class="docutils literal notranslate"><span class="pre">mask_below</span></code> which is used to mask the integrated intensity map produced
during stage 1. <code class="docutils literal notranslate"><span class="pre">ppv_vol</span></code> is provided as a list and given in the format
<code class="docutils literal notranslate"><span class="pre">ppv_vol</span> <span class="pre">=</span> <span class="pre">[min_vel,</span> <span class="pre">max_vel,</span> <span class="pre">min_y,</span> <span class="pre">max_y,</span> <span class="pre">min_x,</span> <span class="pre">max_x]</span></code>.
These are the ranges over which the fitting will be performed. This tutorial
is tuned to the n2h+ data, which has hyperfine structure. Here we implement the
range 32-42 km/s since this allows us to focus on the isolated hyperfine
component, which we model as a Gaussian.</p>
</div>
<div class="section" id="stage-1">
<h2>Stage 1<a class="headerlink" href="#stage-1" title="Permalink to this headline">¶</a></h2>
<p>As discussed in the <a class="reference internal" href="description.html#description"><span class="std std-ref">description</span></a> of the code, the purpose
of stage 1 is to identify the spatial area over which to fit the data. Stage 1
requires several key parameters. To run stage 1 you can use</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">scouse</span><span class="o">.</span><span class="n">stage_1</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">datadirectory</span><span class="p">,</span> <span class="n">wsaa</span><span class="p">,</span>
                   <span class="n">ppv_vol</span><span class="o">=</span><span class="n">ppv_vol</span><span class="p">,</span>
                   <span class="n">outputdir</span><span class="o">=</span><span class="n">outputdir</span><span class="p">,</span>
                   <span class="n">mask_below</span><span class="o">=</span><span class="n">mask_below</span><span class="p">,</span>
                   <span class="n">fittype</span><span class="o">=</span><span class="s1">&#39;gaussian&#39;</span><span class="p">,</span>
                   <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                   <span class="n">write_moments</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">save_fig</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Here I’ve used the keywords <code class="docutils literal notranslate"><span class="pre">write_moments=True</span></code> and <code class="docutils literal notranslate"><span class="pre">save_fig=True</span></code>. The
former will produce FITS files of the zeroth, first, and second order moments of
the data. It will also create a FITS file containing the spectral coordinate of
the maximum value of the spectrum. The latter keyword creates a simple plot of
the coverage that will be used during the fitting procedure. The terminal output
should look something like this…</p>
<a class="reference internal image-reference" href="_images/stage1.png"><img alt="_images/stage1.png" class="align-center" src="_images/stage1.png" style="width: 900px;" /></a>
<p>Where it tells us that we will have to fit a total of 12 spatially averaged
spectra and that the total number of spectra to fit is 126. The output coverage
map for this particular tutorial is not much to look at, but here it is anyway…</p>
<a class="reference internal image-reference" href="_images/n2h+10_37_coverage.png"><img alt="_images/n2h+10_37_coverage.png" class="align-center" src="_images/n2h+10_37_coverage.png" style="width: 300px;" /></a>
</div>
<div class="section" id="stage-2">
<h2>Stage 2<a class="headerlink" href="#stage-2" title="Permalink to this headline">¶</a></h2>
<p>Stage 2 is where we will perform our manual fitting. It is simple to run using</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">scouse</span><span class="o">.</span><span class="n">stage_2</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">write_ascii</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>where the keyword <code class="docutils literal notranslate"><span class="pre">write_ascii</span></code> has been set to output the best-fitting
solutions as an ascii file at the end of the fitting procedure. The fitting
process is based on the interactive process of <a class="reference external" href="https://github.com/pyspeckit/pyspeckit">pyspeckit</a>. Initialising the fitter will look
a bit like this..</p>
<a class="reference internal image-reference" href="_images/stage2_1.png"><img alt="_images/stage2_1.png" class="align-center" src="_images/stage2_1.png" style="width: 900px;" /></a>
<p>where we will have an indication of how many spectra we have to fit (and how
many we have already fitted), as well as some important info for the <code class="docutils literal notranslate"><span class="pre">pyspeckit</span></code>
interactive fitter. Upon running stage 2, a window should have popped up where
one of the spatially averaged spectra will be displayed. Interactive fitting
can be performed using several commands. To indicate components you would like
to fit select each component twice, once somewhere close to the peak emission
and another click to indicate (roughly) the full-width at half-maximum. In my
experience with this, you don’t need to be particularly accurate, <code class="docutils literal notranslate"><span class="pre">pyspeckit</span></code>
does an excellent job of picking up the components you have selected. Selection
can be made either using the keyboard (<code class="xref py py-obj docutils literal notranslate"><span class="pre">m</span></code>) or mouse. Once selected this will
look something like this…</p>
<a class="reference internal image-reference" href="_images/stage2_2.png"><img alt="_images/stage2_2.png" class="align-center" src="_images/stage2_2.png" style="width: 400px;" /></a>
<p>If you are happy with your fit, hitting <code class="xref py py-obj docutils literal notranslate"><span class="pre">d</span></code> will lock it in. The resulting
fit will be plotted. At this point <code class="docutils literal notranslate"><span class="pre">scousepy</span></code> will output some useful information
to the terminal…</p>
<a class="reference internal image-reference" href="_images/stage2_3.png"><img alt="_images/stage2_3.png" class="align-center" src="_images/stage2_3.png" style="width: 900px;" /></a>
<p>and will ask if you’re happy with the fit. If the fit looks good, press enter
to continue. This will lock the fit in and overplot the individual components…</p>
<a class="reference internal image-reference" href="_images/stage2_4.png"><img alt="_images/stage2_4.png" class="align-center" src="_images/stage2_4.png" style="width: 400px;" /></a>
<p><code class="docutils literal notranslate"><span class="pre">scousepy</span></code> will then move onto the next spectrum. If you’re not happy with the
fit you can always re-enter the interactive fitter by typing <code class="xref py py-obj docutils literal notranslate"><span class="pre">f</span></code>. Repeat this
process until the process is completed.</p>
<p>For large datasets its worth noting that there are a couple of keywords here
that might be useful, particularly <code class="docutils literal notranslate"><span class="pre">bitesize</span></code>. This enables the user to
perform bitesize fitting where the process is broken down into sessions and the
user fits a fixed number of spectra at any one time. The number of spectra to
fit in any one session can be controlled using the <code class="docutils literal notranslate"><span class="pre">nspec</span></code> keyword.</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2019, Jonathan D. Henshaw.<br/>
      Last updated on 27 Apr 2019.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>